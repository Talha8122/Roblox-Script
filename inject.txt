local Players = game:GetService("Players")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- GUI OLUŞTUR
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "InventoryManager"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = PlayerGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 600) -- Yükseklik artırıldı auto delete için
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -300)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 40)
titleLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
titleLabel.Text = "Eşya Yöneticisi v2.1 + AutoDelete"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 20
titleLabel.Parent = mainFrame

-- EKLEME BÖLÜMÜ
local addFrame = Instance.new("Frame")
addFrame.Size = UDim2.new(1, -10, 0, 80)
addFrame.Position = UDim2.new(0, 5, 0, 45)
addFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
addFrame.Parent = mainFrame

local playerNameBox = Instance.new("TextBox")
playerNameBox.Size = UDim2.new(0.5, -5, 0, 30)
playerNameBox.Position = UDim2.new(0, 0, 0, 5)
playerNameBox.PlaceholderText = "Oyuncu Adı"
playerNameBox.Parent = addFrame

local itemNameBox = Instance.new("TextBox")
itemNameBox.Size = UDim2.new(0.5, -5, 0, 30)
itemNameBox.Position = UDim2.new(0.5, 5, 0, 5)
itemNameBox.PlaceholderText = "Eşya Adı"
itemNameBox.Parent = addFrame

local addButton = Instance.new("TextButton")
addButton.Size = UDim2.new(1, 0, 0, 30)
addButton.Position = UDim2.new(0, 0, 0, 40)
addButton.Text = "EŞYA EKLE"
addButton.BackgroundColor3 = Color3.fromRGB(0, 120, 0)
addButton.TextColor3 = Color3.new(1,1,1)
addButton.Parent = addFrame

-- LİSTELEME BÖLÜMÜ
local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Size = UDim2.new(1, -10, 0, 280)
scrollingFrame.Position = UDim2.new(0, 5, 0, 130)
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollingFrame.ScrollBarThickness = 8
scrollingFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
scrollingFrame.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 5)
listLayout.Parent = scrollingFrame

-- AUTO DELETE BÖLÜMÜ

local autoDeleteEnabled = false
local autoDeleteTargets = {}

-- AutoDelete Aç/Kapa Butonu
local autoDeleteToggle = Instance.new("TextButton", mainFrame)
autoDeleteToggle.Size = UDim2.new(1, -10, 0, 30)
autoDeleteToggle.Position = UDim2.new(0, 5, 0, 420)
autoDeleteToggle.Text = "Auto Delete: Kapalı"
autoDeleteToggle.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
autoDeleteToggle.TextColor3 = Color3.new(1,1,1)
autoDeleteToggle.Font = Enum.Font.SourceSansBold
autoDeleteToggle.TextSize = 18

local function updateAutoDeleteToggleText()
	if autoDeleteEnabled then
		autoDeleteToggle.Text = "Auto Delete: Açık"
		autoDeleteToggle.BackgroundColor3 = Color3.fromRGB(50, 180, 50)
	else
		autoDeleteToggle.Text = "Auto Delete: Kapalı"
		autoDeleteToggle.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
	end
end

autoDeleteToggle.MouseButton1Click:Connect(function()
	autoDeleteEnabled = not autoDeleteEnabled
	updateAutoDeleteToggleText()
end)

updateAutoDeleteToggleText()

-- AutoDelete Hedef Seçimi Dropdown
local dropdown = Instance.new("TextButton", mainFrame)
dropdown.Size = UDim2.new(1, -10, 0, 30)
dropdown.Position = UDim2.new(0, 5, 0, 460)
dropdown.Text = "AutoDelete Hedef Ekle"
dropdown.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
dropdown.TextColor3 = Color3.new(1,1,1)
dropdown.Font = Enum.Font.SourceSans
dropdown.TextSize = 18

local dropdownFrame = Instance.new("Frame", mainFrame)
dropdownFrame.Size = UDim2.new(1, -10, 0, 120)
dropdownFrame.Position = UDim2.new(0, 5, 0, 490)
dropdownFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
dropdownFrame.Visible = false

local dropdownLayout = Instance.new("UIListLayout", dropdownFrame)
dropdownLayout.SortOrder = Enum.SortOrder.LayoutOrder
dropdownLayout.Padding = UDim.new(0, 5)

local function updateDropdown()
	-- Temizle
	for _, c in pairs(dropdownFrame:GetChildren()) do
		if c:IsA("TextButton") then c:Destroy() end
	end
	-- Oyuncuları listele
	for _, plr in ipairs(Players:GetPlayers()) do
		-- Zaten ekliyse atla
		local exists = false
		for _, name in pairs(autoDeleteTargets) do
			if name == plr.Name then
				exists = true
				break
			end
		end
		if not exists then
			local btn = Instance.new("TextButton", dropdownFrame)
			btn.Size = UDim2.new(1, 0, 0, 30)
			btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
			btn.TextColor3 = Color3.new(1,1,1)
			btn.Font = Enum.Font.SourceSans
			btn.TextSize = 18
			btn.Text = plr.Name
			btn.MouseButton1Click:Connect(function()
				table.insert(autoDeleteTargets, plr.Name)
				updateDropdown()
				updateAutoDeleteList()
				dropdownFrame.Visible = false
			end)
		end
	end
end

dropdown.MouseButton1Click:Connect(function()
	dropdownFrame.Visible = not dropdownFrame.Visible
	if dropdownFrame.Visible then
		updateDropdown()
	end
end)

-- AutoDelete Hedef Listesi
local autoDeleteListFrame = Instance.new("Frame", mainFrame)
autoDeleteListFrame.Size = UDim2.new(1, -10, 0, 100)
autoDeleteListFrame.Position = UDim2.new(0, 5, 0, 615)
autoDeleteListFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

local autoDeleteListLayout = Instance.new("UIListLayout", autoDeleteListFrame)
autoDeleteListLayout.SortOrder = Enum.SortOrder.LayoutOrder
autoDeleteListLayout.Padding = UDim.new(0, 4)

local function updateAutoDeleteList()
	-- Temizle
	for _, c in pairs(autoDeleteListFrame:GetChildren()) do
		if c:IsA("Frame") then c:Destroy() end
	end
	for i, name in ipairs(autoDeleteTargets) do
		local itemFrame = Instance.new("Frame", autoDeleteListFrame)
		itemFrame.Size = UDim2.new(1, -10, 0, 30)
		itemFrame.Position = UDim2.new(0, 5, 0, (i-1)*35)
		itemFrame.BackgroundTransparency = 0

		local label = Instance.new("TextLabel", itemFrame)
		label.Size = UDim2.new(0.8, 0, 1, 0)
		label.BackgroundTransparency = 1
		label.Text = name
		label.TextColor3 = Color3.new(1,1,1)
		label.Font = Enum.Font.SourceSansBold
		label.TextSize = 18
		label.TextXAlignment = Enum.TextXAlignment.Left

		local removeBtn = Instance.new("TextButton", itemFrame)
		removeBtn.Size = UDim2.new(0.15, 0, 0.8, 0)
		removeBtn.Position = UDim2.new(0.85, 0, 0.1, 0)
		removeBtn.Text = "❌"
		removeBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
		removeBtn.TextColor3 = Color3.new(1,1,1)
		removeBtn.Font = Enum.Font.SourceSansBold
		removeBtn.TextSize = 22
		removeBtn.AutoButtonColor = true

		removeBtn.MouseButton1Click:Connect(function()
			for i2, v in ipairs(autoDeleteTargets) do
				if v == name then
					table.remove(autoDeleteTargets, i2)
					break
				end
			end
			updateAutoDeleteList()
		end)
	end
end

updateAutoDeleteList()

-- EŞYA SİLME
local function removeItem(playerName, itemName)
	local target = Players:FindFirstChild(playerName)
	if not target then return end

	for _, tool in pairs(target.Backpack:GetChildren()) do
		if tool:IsA("Tool") and tool.Name == itemName then
			tool:Destroy()
		end
	end

	if target.Character then
		for _, tool in pairs(target.Character:GetDescendants()) do
			if tool:IsA("Tool") and tool.Name == itemName then
				tool:Destroy()
			end
		end
	end

	print(playerName .. "'dan " .. itemName .. " silindi!")
end

-- EŞYA EKLEME
local function addItem(playerName, itemName)
	local target = Players:FindFirstChild(playerName)
	if not target then return end

	local newTool = Instance.new("Tool")
	newTool.Name = itemName
	newTool.RequiresHandle = false
	newTool.CanBeDropped = true
	newTool.Parent = target:FindFirstChild("Backpack") or target.Backpack

	print(playerName .. "'a " .. itemName .. " eklendi!")
end

-- BUTON OLUŞTUR
local function createItemButton(targetPlayer, tool)
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, -10, 0, 30)
	button.Text = targetPlayer.Name .. " - " .. tool.Name
	button.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
	button.TextColor3 = Color3.new(1,1,1)

	button.MouseButton1Click:Connect(function()
		removeItem(targetPlayer.Name, tool.Name)
		button:Destroy()
	end)

	button.Parent = scrollingFrame
end

-- ENVANTERİ YENİLE
local function updateList()
	for _, c in pairs(scrollingFrame:GetChildren()) do
		if c:IsA("TextButton") then
			c:Destroy()
		end
	end

	for _, targetPlayer in pairs(Players:GetPlayers()) do
		for _, tool in pairs(targetPlayer.Backpack:GetChildren()) do
			if tool:IsA("Tool") then
				createItemButton(targetPlayer, tool)
			end
		end

		if targetPlayer.Character then
			for _, tool in pairs(targetPlayer.Character:GetDescendants()) do
				if tool:IsA("Tool") then
					createItemButton(targetPlayer, tool)
				end
			end
		end
	end

	-- Scroll güncelle
	local h = 0
	for _, b in pairs(scrollingFrame:GetChildren()) do
		if b:IsA("TextButton") then
			h = h + b.Size.Y.Offset + listLayout.Padding.Offset
		end
	end
	scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, h)
end

-- EKLEME BUTONU EVENT
addButton.MouseButton1Click:Connect(function()
	local pname = playerNameBox.Text
	local iname = itemNameBox.Text

	if pname ~= "" and iname ~= "" then
		addItem(pname, iname)
		updateList()
	end
end)

-- GÜNCELLEME EVENTLERİ
Players.PlayerAdded:Connect(updateList)
Players.PlayerRemoving:Connect(updateList)

for _, p in pairs(Players:GetPlayers()) do
	p.Backpack.ChildAdded:Connect(updateList)
	p.Backpack.ChildRemoved:Connect(updateList)
end

updateList()

-- Auto Delete döngüsü
spawn(function()
	while true do
		if autoDeleteEnabled then
			for _, pname in ipairs(autoDeleteTargets) do
				local target = Players:FindFirstChild(pname)
				if target then
					-- Backpack'teki tüm Tool'ları sil
					for _, tool in pairs(target.Backpack:GetChildren()) do
						if tool:IsA("Tool") then
							tool:Destroy()
						end
					end
					-- Character'deki tüm Tool'ları sil
					if target.Character then
						for _, tool in pairs(target.Character:GetDescendants()) do
							if tool:IsA("Tool") then
								tool:Destroy()
							end
						end
					end
				end
			end
		end
		task.wait(3) -- 3 saniyede bir kontrol eder
	end
end)
